{
  "version": 3,
  "sources": ["../../@azure/msal-browser/src/telemetry/BrowserPerformanceMeasurement.ts"],
  "sourcesContent": ["/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { IPerformanceMeasurement, SubMeasurement } from \"@azure/msal-common\";\r\n\r\nexport class BrowserPerformanceMeasurement implements IPerformanceMeasurement {\r\n    private readonly measureName: string;\r\n    private readonly correlationId: string;\r\n    private readonly startMark: string;\r\n    private readonly endMark: string;\r\n\r\n    constructor(name: string, correlationId: string) {\r\n        this.correlationId = correlationId;\r\n        this.measureName = BrowserPerformanceMeasurement.makeMeasureName(\r\n            name,\r\n            correlationId\r\n        );\r\n        this.startMark = BrowserPerformanceMeasurement.makeStartMark(\r\n            name,\r\n            correlationId\r\n        );\r\n        this.endMark = BrowserPerformanceMeasurement.makeEndMark(\r\n            name,\r\n            correlationId\r\n        );\r\n    }\r\n\r\n    private static makeMeasureName(name: string, correlationId: string) {\r\n        return `msal.measure.${name}.${correlationId}`;\r\n    }\r\n\r\n    private static makeStartMark(name: string, correlationId: string) {\r\n        return `msal.start.${name}.${correlationId}`;\r\n    }\r\n\r\n    private static makeEndMark(name: string, correlationId: string) {\r\n        return `msal.end.${name}.${correlationId}`;\r\n    }\r\n\r\n    static supportsBrowserPerformance(): boolean {\r\n        return (\r\n            typeof window !== \"undefined\" &&\r\n            typeof window.performance !== \"undefined\" &&\r\n            typeof window.performance.mark === \"function\" &&\r\n            typeof window.performance.measure === \"function\" &&\r\n            typeof window.performance.clearMarks === \"function\" &&\r\n            typeof window.performance.clearMeasures === \"function\" &&\r\n            typeof window.performance.getEntriesByName === \"function\"\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Flush browser marks and measurements.\r\n     * @param {string} correlationId\r\n     * @param {SubMeasurement} measurements\r\n     */\r\n    public static flushMeasurements(\r\n        correlationId: string,\r\n        measurements: SubMeasurement[]\r\n    ): void {\r\n        if (BrowserPerformanceMeasurement.supportsBrowserPerformance()) {\r\n            try {\r\n                measurements.forEach((measurement) => {\r\n                    const measureName =\r\n                        BrowserPerformanceMeasurement.makeMeasureName(\r\n                            measurement.name,\r\n                            correlationId\r\n                        );\r\n                    const entriesForMeasurement =\r\n                        window.performance.getEntriesByName(\r\n                            measureName,\r\n                            \"measure\"\r\n                        );\r\n                    if (entriesForMeasurement.length > 0) {\r\n                        window.performance.clearMeasures(measureName);\r\n                        window.performance.clearMarks(\r\n                            BrowserPerformanceMeasurement.makeStartMark(\r\n                                measureName,\r\n                                correlationId\r\n                            )\r\n                        );\r\n                        window.performance.clearMarks(\r\n                            BrowserPerformanceMeasurement.makeEndMark(\r\n                                measureName,\r\n                                correlationId\r\n                            )\r\n                        );\r\n                    }\r\n                });\r\n            } catch (e) {\r\n                // Silently catch and return null\r\n            }\r\n        }\r\n    }\r\n\r\n    startMeasurement(): void {\r\n        if (BrowserPerformanceMeasurement.supportsBrowserPerformance()) {\r\n            try {\r\n                window.performance.mark(this.startMark);\r\n            } catch (e) {\r\n                // Silently catch\r\n            }\r\n        }\r\n    }\r\n\r\n    endMeasurement(): void {\r\n        if (BrowserPerformanceMeasurement.supportsBrowserPerformance()) {\r\n            try {\r\n                window.performance.mark(this.endMark);\r\n                window.performance.measure(\r\n                    this.measureName,\r\n                    this.startMark,\r\n                    this.endMark\r\n                );\r\n            } catch (e) {\r\n                // Silently catch\r\n            }\r\n        }\r\n    }\r\n\r\n    flushMeasurement(): number | null {\r\n        if (BrowserPerformanceMeasurement.supportsBrowserPerformance()) {\r\n            try {\r\n                const entriesForMeasurement =\r\n                    window.performance.getEntriesByName(\r\n                        this.measureName,\r\n                        \"measure\"\r\n                    );\r\n                if (entriesForMeasurement.length > 0) {\r\n                    const durationMs = entriesForMeasurement[0].duration;\r\n                    window.performance.clearMeasures(this.measureName);\r\n                    window.performance.clearMarks(this.startMark);\r\n                    window.performance.clearMarks(this.endMark);\r\n                    return durationMs;\r\n                }\r\n            } catch (e) {\r\n                // Silently catch and return null\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;IAOa;;;IAAA,sCAAA,+BAA6B;MAMtC,YAAY,MAAc,eAAqB;AAC3C,aAAK,gBAAgB;AACrB,aAAK,cAAc,+BAA8B,gBAC7C,MACA,aAAa;AAEjB,aAAK,YAAY,+BAA8B,cAC3C,MACA,aAAa;AAEjB,aAAK,UAAU,+BAA8B,YACzC,MACA,aAAa;;MAIb,OAAO,gBAAgB,MAAc,eAAqB;AAC9D,eAAO,gBAAgB,IAAI,IAAI,aAAa;;MAGxC,OAAO,cAAc,MAAc,eAAqB;AAC5D,eAAO,cAAc,IAAI,IAAI,aAAa;;MAGtC,OAAO,YAAY,MAAc,eAAqB;AAC1D,eAAO,YAAY,IAAI,IAAI,aAAa;;MAG5C,OAAO,6BAA0B;AAC7B,eACI,OAAO,WAAW,eAClB,OAAO,OAAO,gBAAgB,eAC9B,OAAO,OAAO,YAAY,SAAS,cACnC,OAAO,OAAO,YAAY,YAAY,cACtC,OAAO,OAAO,YAAY,eAAe,cACzC,OAAO,OAAO,YAAY,kBAAkB,cAC5C,OAAO,OAAO,YAAY,qBAAqB;;;;;;;MAShD,OAAO,kBACV,eACA,cAA8B;AAE9B,YAAI,+BAA8B,2BAA0B,GAAI;AAC5D,cAAI;AACA,yBAAa,QAAQ,CAAC,gBAAe;AACjC,oBAAM,cACF,+BAA8B,gBAC1B,YAAY,MACZ,aAAa;AAErB,oBAAM,wBACF,OAAO,YAAY,iBACf,aACA,SAAS;AAEjB,kBAAI,sBAAsB,SAAS,GAAG;AAClC,uBAAO,YAAY,cAAc,WAAW;AAC5C,uBAAO,YAAY,WACf,+BAA8B,cAC1B,aACA,aAAa,CAChB;AAEL,uBAAO,YAAY,WACf,+BAA8B,YAC1B,aACA,aAAa,CAChB;cAER;YACL,CAAC;UACJ,SAAQ,GAAG;UAEX;QACJ;;MAGL,mBAAgB;AACZ,YAAI,+BAA8B,2BAA0B,GAAI;AAC5D,cAAI;AACA,mBAAO,YAAY,KAAK,KAAK,SAAS;UACzC,SAAQ,GAAG;UAEX;QACJ;;MAGL,iBAAc;AACV,YAAI,+BAA8B,2BAA0B,GAAI;AAC5D,cAAI;AACA,mBAAO,YAAY,KAAK,KAAK,OAAO;AACpC,mBAAO,YAAY,QACf,KAAK,aACL,KAAK,WACL,KAAK,OAAO;UAEnB,SAAQ,GAAG;UAEX;QACJ;;MAGL,mBAAgB;AACZ,YAAI,+BAA8B,2BAA0B,GAAI;AAC5D,cAAI;AACA,kBAAM,wBACF,OAAO,YAAY,iBACf,KAAK,aACL,SAAS;AAEjB,gBAAI,sBAAsB,SAAS,GAAG;AAClC,oBAAM,aAAa,sBAAsB,CAAC,EAAE;AAC5C,qBAAO,YAAY,cAAc,KAAK,WAAW;AACjD,qBAAO,YAAY,WAAW,KAAK,SAAS;AAC5C,qBAAO,YAAY,WAAW,KAAK,OAAO;AAC1C,qBAAO;YACV;UACJ,SAAQ,GAAG;UAEX;QACJ;AACD,eAAO;;IAEd;;;",
  "names": []
}
